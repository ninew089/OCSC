{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar util_1 = require(\"./util\");\n\nvar EPSILON = 0.0001;\n/**\n * 使用牛顿切割法求最近的点\n * @param {number[]} xArr      点的 x 数组\n * @param {number[]} yArr      点的 y 数组\n * @param {number}   x         指定的点 x\n * @param {number}   y         指定的点 y\n * @param {Function} tCallback 差值函数\n */\n\nfunction nearestPoint(xArr, yArr, x, y, tCallback) {\n  var t;\n  var interval = 0.005;\n  var d = Infinity;\n  var v0 = [x, y];\n\n  for (var i = 0; i <= 20; i++) {\n    var _t = i * 0.05;\n\n    var v1 = [tCallback.apply(null, xArr.concat([_t])), tCallback.apply(null, yArr.concat([_t]))];\n    var d1 = util_1.distance(v0[0], v0[1], v1[0], v1[1]);\n\n    if (d1 < d) {\n      t = _t;\n      d = d1;\n    }\n  } // 提前终止\n\n\n  if (t === 0) {\n    return {\n      x: xArr[0],\n      y: yArr[0]\n    };\n  }\n\n  if (t === 1) {\n    var count = xArr.length;\n    return {\n      x: xArr[count - 1],\n      y: yArr[count - 1]\n    };\n  }\n\n  d = Infinity;\n\n  for (var i = 0; i < 32; i++) {\n    if (interval < EPSILON) {\n      break;\n    }\n\n    var prev = t - interval;\n    var next = t + interval;\n    var v1 = [tCallback.apply(null, xArr.concat([prev])), tCallback.apply(null, yArr.concat([prev]))];\n    var d1 = util_1.distance(v0[0], v0[1], v1[0], v1[1]);\n\n    if (prev >= 0 && d1 < d) {\n      t = prev;\n      d = d1;\n    } else {\n      var v2 = [tCallback.apply(null, xArr.concat([next])), tCallback.apply(null, yArr.concat([next]))];\n      var d2 = util_1.distance(v0[0], v0[1], v2[0], v2[1]);\n\n      if (next <= 1 && d2 < d) {\n        t = next;\n        d = d2;\n      } else {\n        interval *= 0.5;\n      }\n    }\n  }\n\n  return {\n    x: tCallback.apply(null, xArr.concat([t])),\n    y: tCallback.apply(null, yArr.concat([t]))\n  };\n}\n\nexports.nearestPoint = nearestPoint; // 近似求解 https://community.khronos.org/t/3d-cubic-bezier-segment-length/62363/2\n\nfunction snapLength(xArr, yArr) {\n  var totalLength = 0;\n  var count = xArr.length;\n\n  for (var i = 0; i < count; i++) {\n    var x = xArr[i];\n    var y = yArr[i];\n    var nextX = xArr[(i + 1) % count];\n    var nextY = yArr[(i + 1) % count];\n    totalLength += util_1.distance(x, y, nextX, nextY);\n  }\n\n  return totalLength / 2;\n}\n\nexports.snapLength = snapLength;","map":{"version":3,"sources":["../src/bezier.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"./util\");\nvar EPSILON = 0.0001;\n/**\n * 使用牛顿切割法求最近的点\n * @param {number[]} xArr      点的 x 数组\n * @param {number[]} yArr      点的 y 数组\n * @param {number}   x         指定的点 x\n * @param {number}   y         指定的点 y\n * @param {Function} tCallback 差值函数\n */\nfunction nearestPoint(xArr, yArr, x, y, tCallback) {\n    var t;\n    var interval = 0.005;\n    var d = Infinity;\n    var v0 = [x, y];\n    for (var i = 0; i <= 20; i++) {\n        var _t = i * 0.05;\n        var v1 = [tCallback.apply(null, xArr.concat([_t])), tCallback.apply(null, yArr.concat([_t]))];\n        var d1 = util_1.distance(v0[0], v0[1], v1[0], v1[1]);\n        if (d1 < d) {\n            t = _t;\n            d = d1;\n        }\n    }\n    // 提前终止\n    if (t === 0) {\n        return {\n            x: xArr[0],\n            y: yArr[0],\n        };\n    }\n    if (t === 1) {\n        var count = xArr.length;\n        return {\n            x: xArr[count - 1],\n            y: yArr[count - 1],\n        };\n    }\n    d = Infinity;\n    for (var i = 0; i < 32; i++) {\n        if (interval < EPSILON) {\n            break;\n        }\n        var prev = t - interval;\n        var next = t + interval;\n        var v1 = [tCallback.apply(null, xArr.concat([prev])), tCallback.apply(null, yArr.concat([prev]))];\n        var d1 = util_1.distance(v0[0], v0[1], v1[0], v1[1]);\n        if (prev >= 0 && d1 < d) {\n            t = prev;\n            d = d1;\n        }\n        else {\n            var v2 = [tCallback.apply(null, xArr.concat([next])), tCallback.apply(null, yArr.concat([next]))];\n            var d2 = util_1.distance(v0[0], v0[1], v2[0], v2[1]);\n            if (next <= 1 && d2 < d) {\n                t = next;\n                d = d2;\n            }\n            else {\n                interval *= 0.5;\n            }\n        }\n    }\n    return {\n        x: tCallback.apply(null, xArr.concat([t])),\n        y: tCallback.apply(null, yArr.concat([t])),\n    };\n}\nexports.nearestPoint = nearestPoint;\n// 近似求解 https://community.khronos.org/t/3d-cubic-bezier-segment-length/62363/2\nfunction snapLength(xArr, yArr) {\n    var totalLength = 0;\n    var count = xArr.length;\n    for (var i = 0; i < count; i++) {\n        var x = xArr[i];\n        var y = yArr[i];\n        var nextX = xArr[(i + 1) % count];\n        var nextY = yArr[(i + 1) % count];\n        totalLength += util_1.distance(x, y, nextX, nextY);\n    }\n    return totalLength / 2;\n}\nexports.snapLength = snapLength;\n//# sourceMappingURL=bezier.js.map"]},"metadata":{},"sourceType":"script"}